name: Build Static Site

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install Dependencies
      run: npm install

    # [关键修复] 强制只编译 Monorepo 中的 @flow/website 子项目
    # 这能绕过其他子项目可能存在的 TS 检查错误或构建问题
    - name: Force Build Website Only
      run: npx turbo run build --scope=@flow/website --force-build

    # 排错步骤：列出 apps/website/ 目录下的所有文件，确认 dist 目录已生成
    - name: Debug - List Website Output
      run: |
        echo "=== Listing Website Output Directory ==="
        # 尝试列出最终的 dist 目录内容
        ls -R apps/website/dist/ || echo "apps/website/dist/ not found (Build failure)"

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: flow-reader-dist
        # [路径修正] Monorepo 编译产物位于子目录
        path: apps/website/dist/
